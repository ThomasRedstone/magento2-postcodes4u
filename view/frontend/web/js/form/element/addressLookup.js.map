{"version":3,"sources":["frontend/web/js/form/element/addressLookup.js"],"names":["define","ko","Element","loadListener","Initializer","Strategy","addressData","extend","onElementRender","el","isPostcodes4uApiLoaded","subscribe","isApiLoaded","initializer","autocomplete_id","initialize","_super","isShowDetails","getForm","value","observable","country","toggleAddressData","data","evt","preventDefault","findAddress","addressId","strUrl","_this","jQuery","zipEnter","document","getElementById","html","css","loader","encodeURI","window","UserName","ApiKey","ajax","url","type","dataType","cors","contentType","secure","showLoader","headers","beforeSend","xhr","setRequestHeader","btoa","success","ul","empty","Error","Cause","text","Resolution","appendTo","Summaries","length","each","Id","StreetAddress","Place","error","console"],"mappings":"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","file":"addressLookup.js","sourcesContent":["\ndefine([\n    'ko',\n    'Magento_Ui/js/form/element/abstract',\n    'Postcodes4uAddressLookup/model/apiLoadListener',\n    'Postcodes4uAddressLookup/model/postcodes4u/initializer',\n    'Postcodes4uAddressLookup/model/postcodes4u/strategy/default',\n    'Postcodes4uAddressLookup/model/address/addressData',\n], function (ko, Element, loadListener, Initializer, Strategy, addressData) {\n    'use strict';\n\n    return Element.extend({\n        onElementRender: function (el) {\n            if (!loadListener.isPostcodes4uApiLoaded()) {\n                loadListener.subscribe((isApiLoaded) => {\n                    if (isApiLoaded) {\n                        this.initializer = new Initializer(el, Strategy, this.autocomplete_id);\n                    }\n                });\n            } else {\n                this.initializer = new Initializer(el, Strategy, this.autocomplete_id);\n            }\n        },\n        initialize: function () {\n            this._super();\n            this.isShowDetails = addressData.getForm(this.autocomplete_id).isShowDetails;\n            this.value = ko.observable('');\n\n            addressData.getForm(this.autocomplete_id).country.subscribe(() => {\n                this.value('');\n            });\n\n            return this;\n        },\n        toggleAddressData: function (data, evt) {\n            evt.preventDefault();\n            addressData.getForm(this.autocomplete_id).isShowDetails(true);\n        },\n        findAddress: function findAddress(data, evt) {\n            var addressId = this.autocomplete_id;\n            var strUrl = \"\",_this = jQuery;\n            var zipEnter = document.getElementById('lookup').value;\n            if(!zipEnter){\n                _this('.show_address').html('Please enter postcode!');\n                _this('.show_address').css('color','red');\n            } else {\n                //Start loader\n                _this('body').loader('show');\n                strUrl =\n                    \"https://services.3xsoftware.co.uk/Search/ByPostcode/json?username=\" + encodeURI(window.UserName)\n                    + \"&key=\" + encodeURI(window.ApiKey)\n                    + \"&postcode=\" + encodeURI(zipEnter);\n                _this.ajax({\n                    url: strUrl,\n                    type: 'GET',\n                    dataType: 'jsonp',\n                    cors: true ,\n                    contentType:'application/json',\n                    secure: true,\n                    showLoader: true,\n                    headers: {\n                        'Access-Control-Allow-Origin': '*',\n                    },\n                    beforeSend: function (xhr) {\n                        xhr.setRequestHeader (\"Authorization\", \"Basic \" + btoa(\"\"));\n                    },\n                    success: function (data){\n                        var ul = _this('<ul>', {'class': 'address-ul'});\n                        _this('.show_address').empty();\n                        if(data.Error && data.Error.Cause) {\n                            _this('<li>', {\n                                'id': 'error',\n                                'class': 'address-li',\n                            }).text(\n                                data.Error.Cause +\n                                data.Error.Resolution ? (': ' + data.Error.Resolution): ''\n                            ).appendTo(ul);\n                        } else if(data.Summaries && data.Summaries.length > 0) {\n                            _this.each(data.Summaries, function() {\n                                _this('<li>', {\n                                    'id': this.Id,\n                                    'class': 'address-li',\n                                    'onclick': \"return checkoutAddress('\" + this.Id + \"','\" + addressId + \"')\"\n                                }).text(this.StreetAddress + ', ' + this.Place).appendTo(ul);\n                            });\n                        } else {\n                            _this('<li>', {\n                                'id': 'error',\n                                'class': 'address-li',\n                            }).text('Error: No results found').appendTo(ul);\n                        }\n                        _this(ul).appendTo('.show_address');\n                        _this('body').loader('hide');\n                        evt.preventDefault();\n                        addressData.getForm(addressId).isShowDetails(true);\n                    },\n                    error: function (data){\n                        _this(data).appendTo('.show_address');\n                        _this('body').loader('hide');\n                        console.error(data);\n                    }\n                });\n            }\n        }\n    });\n});\n"]}